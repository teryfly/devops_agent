# AIé¡¹ç›®åŠ©æ‰‹å®¢æˆ·ç«¯

## ä¸€ã€ä½¿ç”¨è¯´æ˜

### å‘½ä»¤æ ¼å¼
```
python main.py <æ­¥éª¤> --N <é¡¹ç›®åç§°> --F <æ–‡ä»¶è·¯å¾„> [å¯é€‰å‚æ•°]
```

### æ­¥éª¤è¯´æ˜
- `A`: è·å–é¡¹ç›®è®¡åˆ’ (å¯¹åº”åŸget-plan)
- `B`: æ‰§è¡Œç°æœ‰è®¡åˆ’ (å¯¹åº”åŸexecute-plan)
- `AB`: è·å–å¹¶æ‰§è¡Œè®¡åˆ’ (å¯¹åº”åŸget-and-execute)

### å‚æ•°è¯´æ˜
| å‚æ•° | å¿…é€‰ | è¯´æ˜ |
|------|------|------|
| `--N` | æ˜¯ | é¡¹ç›®ID/åç§° |
| `--F` | æ˜¯ | æ–‡ä»¶è·¯å¾„ (A/ABæ­¥éª¤ä¸ºéœ€æ±‚æ–‡ä»¶ï¼ŒBæ­¥éª¤ä¸ºè®¡åˆ’æ–‡ä»¶) |
| `--grpc` | å¦ | gRPCæœåŠ¡å™¨åœ°å€ (é»˜è®¤: localhost:50051) |
| `--model` | å¦ | ä½¿ç”¨çš„æ¨¡å‹ (ä»…A/ABæ­¥éª¤éœ€è¦ï¼Œé»˜è®¤: GPT-4.1) |
| `--llm-url` | å¦ | LLM API URL (ä»…A/ABæ­¥éª¤éœ€è¦) |

### ä½¿ç”¨ç¤ºä¾‹

#### 1. è·å–é¡¹ç›®è®¡åˆ’ (A)
```bash
python main.py A \
  --N myproject \
  --F requirement.txt \
  --model GPT-4.1 \
  --llm-url http://llm-server/v1
```

#### 2. æ‰§è¡Œç°æœ‰è®¡åˆ’ (B)
```bash
python main.py B --N ProjetNameMedCode --F path/to/plan.txt
```

#### 3. è·å–å¹¶æ‰§è¡Œè®¡åˆ’ (AB)
```bash
python main.py AB \
  --N medCode-Claude-3.5 \
  --F designDocs/medCode-cn.txt \
  --model Claude-3.5-Sonnet \
  --llm-url http://192.168.120.238:8001/v1/chat/completions
```

### æ³¨æ„äº‹é¡¹
1. å¯¹äºæ­¥éª¤Aå’ŒABï¼Œ`--F`å‚æ•°æŒ‡å®šéœ€æ±‚æ–‡ä»¶è·¯å¾„
2. å¯¹äºæ­¥éª¤Bï¼Œ`--F`å‚æ•°æŒ‡å®šè®¡åˆ’æ–‡ä»¶è·¯å¾„
3. `--model`å’Œ`--llm-url`å‚æ•°ä»…åœ¨æ­¥éª¤Aå’ŒABä¸­æœ‰æ•ˆ
4. è¯·ç¡®ä¿gRPCæœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œåœ¨æŒ‡å®šåœ°å€

## äºŒã€å®¢æˆ·ç«¯æ—¥å¿—æ‹¼è£…é€»è¾‘

å®¢æˆ·ç«¯ä½¿ç”¨ `client/utils.py` ä¸­çš„ `print_feedback` å‡½æ•°å°† `ActionFeedback` è½¬æ¢ä¸ºå¯è¯»æ—¥å¿—ï¼š

```
def print_feedback(feedback):
    # çŠ¶æ€å›¾æ ‡æ˜ å°„
    status_icons = {
        "running": "ğŸ”„",
        "success": "âœ…",
        "warning": "âš ï¸",
        "failed": "âŒ"
    }
    
    # çŠ¶æ€æ ‡ç­¾æ˜ å°„
    status_labels = {
        "running": "è¿è¡Œä¸­",
        "success": "æˆåŠŸ",
        "warning": "è­¦å‘Š",
        "failed": "å¤±è´¥"
    }
    
    # è·å–çŠ¶æ€å›¾æ ‡å’Œæ ‡ç­¾
    icon = status_icons.get(feedback.status.lower(), "â“")
    status_label = status_labels.get(feedback.status.lower(), 
                                   feedback.status.upper())
    
    # åŒºåˆ†è®¡åˆ’æ­¥éª¤å’Œæ‰§è¡Œæ­¥éª¤
    if feedback.action_index < 0:
        step_type = "ğŸ“ è®¡åˆ’"  # è®¡åˆ’ç”Ÿæˆé˜¶æ®µ
    else:
        step_type = f"ğŸ”§ æ­¥éª¤ {feedback.step_index}/{feedback.total_steps}"
    
    # æ„å»ºä¸»æ—¥å¿—è¡Œ
    print(f"{icon} [{status_label}] {step_type} - {feedback.step_description}")
    
    # æ·»åŠ è¾“å‡ºå†…å®¹ï¼ˆæˆªæ–­é•¿æ–‡æœ¬ï¼‰
    if feedback.output:
        truncated_output = truncate_long_text(feedback.output)
        print(f"  ğŸ“¤ è¾“å‡º: {truncated_output}")
    
    # æ·»åŠ é”™è¯¯ä¿¡æ¯ï¼ˆæˆªæ–­é•¿æ–‡æœ¬ï¼‰
    if feedback.error:
        truncated_error = truncate_long_text(feedback.error)
        print(f"  âš ï¸ é”™è¯¯: {truncated_error}")
    
    print("-" * 60)  # åˆ†éš”çº¿
```

## ä¸‰. æ—¥å¿—æ‹¼è£…ç¤ºä¾‹

### è®¡åˆ’ç”Ÿæˆé˜¶æ®µæ—¥å¿—ï¼š

```
ğŸ“ [æˆåŠŸ] ğŸ“ è®¡åˆ’ - å®Œæ•´è®¡åˆ’ç”Ÿæˆå®Œæ¯•
```

### æ‰§è¡Œé˜¶æ®µæ—¥å¿—ï¼š

```
ğŸ”„ [è¿è¡Œä¸­] ğŸ”§ æ­¥éª¤ 1/33 - file_edit(command='create', path='backend/app/main.py')
  ğŸ“¤ è¾“å‡º: æ–‡ä»¶åˆ›å»ºæˆåŠŸ: /aiWorkDir/my-project-123/backend/app/main.py
------------------------------------------------------------
âœ… [æˆåŠŸ] ğŸ”§ æ­¥éª¤ 1/33 - directory(command='create', path='backend/app/models')
------------------------------------------------------------
âŒ [å¤±è´¥] ğŸ”§ æ­¥éª¤ 2/33 - shell_command(command='npm install')
  âš ï¸ é”™è¯¯: npm: command not found
------------------------------------------------------------
```

## å››. æœåŠ¡ç«¯è¿”å›å­—æ®µä½¿ç”¨åœºæ™¯æ€»ç»“

| å­—æ®µå             | ç±»å‹   | ä½¿ç”¨åœºæ™¯                   | æ—¥å¿—ä¸­çš„è¡¨ç°                 |
| :----------------- | :----- | :------------------------- | :--------------------------- |
| `action_index`     | int32  | æ ‡è¯†å½“å‰åŠ¨ä½œåœ¨æ­¥éª¤ä¸­çš„ä½ç½® | ç”¨äºåŒºåˆ†è®¡åˆ’ç”Ÿæˆå’Œæ‰§è¡ŒåŠ¨ä½œ   |
| `action_type`      | string | åŠ¨ä½œç±»å‹                   | æ˜¾ç¤ºåœ¨æè¿°ä¸­ï¼ˆå¦‚ file_editï¼‰ |
| `step_description` | string | åŠ¨ä½œæè¿°                   | æ—¥å¿—çš„æ ¸å¿ƒæè¿°å†…å®¹           |
| `status`           | string | æ‰§è¡ŒçŠ¶æ€                   | å†³å®šå›¾æ ‡å’ŒçŠ¶æ€æ ‡ç­¾           |
| `output`           | string | æ ‡å‡†è¾“å‡º                   | åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºä¸º"è¾“å‡º"         |
| `error`            | string | é”™è¯¯ä¿¡æ¯                   | åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºä¸º"é”™è¯¯"         |
| `command`          | string | æ‰§è¡Œçš„å‘½ä»¤                 | åœ¨æè¿°ä¸­æ˜¾ç¤ºå…·ä½“å‘½ä»¤         |
| `step_index`       | int32  | å½“å‰æ­¥éª¤åºå·               | æ˜¾ç¤ºåœ¨æ­¥éª¤æ ‡è¯†ä¸­             |
| `total_steps`      | int32  | æ€»æ­¥éª¤æ•°                   | æ˜¾ç¤ºåœ¨æ­¥éª¤æ ‡è¯†ä¸­             |
| `exit_code`        | int32  | é€€å‡ºç                      | ç”¨äºå†…éƒ¨åˆ¤æ–­ï¼Œä¸ç›´æ¥æ˜¾ç¤º     |
| `complete_plan`    | string | å®Œæ•´è®¡åˆ’                   | ä¿å­˜åˆ°æ–‡ä»¶ï¼Œä¸æ˜¾ç¤ºåœ¨æ—¥å¿—     |

## äº”. å®Œæ•´æ—¥å¿—ç”Ÿæˆæµç¨‹

1. **æœåŠ¡ç«¯æ‰§è¡Œ**ï¼š
   - Agent è§£æè®¡åˆ’å¹¶æ‰§è¡ŒåŠ¨ä½œ
   - ç”ŸæˆåŒ…å«è¯¦ç»†ä¿¡æ¯çš„ `ActionFeedback` å¯¹è±¡
   - é€šè¿‡ gRPC æµå¼å‘é€ç»™å®¢æˆ·ç«¯
2. **å®¢æˆ·ç«¯å¤„ç†**ï¼š
   - æ¥æ”¶ `ActionFeedback` æµ
   - è°ƒç”¨ `print_feedback()` æ ¼å¼åŒ–æ¯æ¡åé¦ˆ
   - ä½¿ç”¨ `save_execution_log()` ä¿å­˜å®Œæ•´æ—¥å¿—
   - ä½¿ç”¨ `print_summary()` æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡ä¿¡æ¯
3. **ç”¨æˆ·çœ‹åˆ°çš„æ—¥å¿—**ï¼š
   - å®æ—¶æ˜¾ç¤ºæ¯ä¸ªåŠ¨ä½œçš„æ‰§è¡ŒçŠ¶æ€
   - æˆåŠŸ/å¤±è´¥æœ‰æ˜ç¡®çš„è§†è§‰æ ‡è¯†
   - é•¿æ–‡æœ¬è‡ªåŠ¨æˆªæ–­ä¿è¯å¯è¯»æ€§
   - æ­¥éª¤è¿›åº¦æ¸…æ™°å¯è§
   - é”™è¯¯ä¿¡æ¯çªå‡ºæ˜¾ç¤º